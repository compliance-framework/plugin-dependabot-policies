package vulnerability_patch_available_test

import data.vulnerability_patch_available

test_dismissed_vulnerability_no_patch_available_ok if {
	count(vulnerability_patch_available.violation) == 0 with input as {"alerts": [{
		"state": "open",
		"dismissed_at": "2025-09-11T16:24:18Z",
		"security_vulnerability": {"first_patched_version": null},
	}]}
}

test_non_dismissed_vulnerability_no_patch_available_ok if {
	count(vulnerability_patch_available.violation) == 0 with input as {"alerts": [{
		"state": "open",
		"dismissed_at": null,
		"security_vulnerability": {"first_patched_version": null},
	}]}
}

test_non_dismissed_vulnerability_patch_available_ok if {
	count(vulnerability_patch_available.violation) == 0 with input as {"alerts": [{
		"state": "open",
		"dismissed_at": null,
		"security_vulnerability": {"first_patched_version": {"identifier": "2.4.0"}},
	}]}
}

test_dismissed_vulnerability_patch_available_violation if {
	count(vulnerability_patch_available.violation) == 1 with input as {"alerts": [{
		"state": "open",
		"dismissed_at": "2025-09-11T16:24:18Z",
		"security_vulnerability": {"first_patched_version": {"identifier": "2.4.0"}},
	}]}
}

test_dismissed_vulnerabilities_patch_available_violation if {
	count(vulnerability_patch_available.violation) == 1 with input as {"alerts": [
		{
			"state": "open",
			"dismissed_at": "2025-09-11T16:24:18Z",
			"security_vulnerability": {"first_patched_version": {"identifier": "2.4.0"}},
		},
		{
			"state": "open",
			"dismissed_at": "2025-09-11T16:24:18Z",
			"security_vulnerability": {"first_patched_version": null},
		},
	]}
}
