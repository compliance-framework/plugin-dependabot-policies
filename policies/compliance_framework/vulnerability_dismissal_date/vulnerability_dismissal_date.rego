package compliance_framework.vulnerability_dismissal_date

NINETY_DAYS_NS := 7776000000000000

violation[{}] if {
	ninety_days_earlier := time.now_ns() - NINETY_DAYS_NS

	# Build a set of alerts that have been dismissed for longer than 90 days
	dismissed_alerts := [alert |
		alert := input.alerts[_]
		alert.dismissed_at != null
		print(time.parse_rfc3339_ns(alert.dismissed_at))
		time.parse_rfc3339_ns(alert.dismissed_at) < ninety_days_earlier
	]

	# If there are 1 or more such alerts, then deny.
	count(dismissed_alerts) >= 1
}

title := "Limit age of dismissed vulnerabilities"
description := "Vulnerabilities dismissed more than 90 days ago should be re-opened and re-assessed."
